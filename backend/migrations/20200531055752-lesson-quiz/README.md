# Migration `20200531055752-lesson-quiz`

This migration has been generated by Angad Singh at 5/31/2020, 5:57:52 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE `tgc-build`.`Lesson` ADD COLUMN `maxScore` int   ,
ADD COLUMN `quiz` varchar(191)   ;

ALTER TABLE `tgc-build`.`UserQuiz` DROP FOREIGN KEY `userquiz_ibfk_1`,
DROP COLUMN `quizId`,
ADD COLUMN `lessonId` int NOT NULL ;

ALTER TABLE `tgc-build`.`Quiz` DROP FOREIGN KEY `quiz_ibfk_1`;

ALTER TABLE `tgc-build`.`UserQuiz` ADD FOREIGN KEY (`lessonId`) REFERENCES `tgc-build`.`Lesson`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE `tgc-build`.`Quiz`;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200531040621-lesson-past..20200531055752-lesson-quiz
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "mysql"
-  url = "***"
+  url      = env("MYSQL_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -39,9 +39,11 @@
   materials    String?
   hindiVideo   String?
   englishVideo String?
   attendance   Attendance[]
-  quiz         Quiz
+  quiz         String?
+  maxScore     Int?
+  quizAttempts UserQuiz[]
 }
 model Attendance {
   id        Int      @id @default(autoincrement())
@@ -53,25 +55,14 @@
   user      User     @relation(fields: [userId], references: [id])
   present   Boolean  @default(true)
 }
-model Quiz {
-  id        Int        @id @default(autoincrement())
-  createdAt DateTime   @default(now())
-  updatedAt DateTime   @updatedAt
-  lessonId  Int
-  lesson    Lesson     @relation(fields: [lessonId], references: [id])
-  form      String
-  max       Int
-  UserQuiz  UserQuiz[]
-}
-
 model UserQuiz {
   id        Int      @id @default(autoincrement())
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
-  quizId    Int
-  quiz      Quiz     @relation(fields: [quizId], references: [id])
+  lessonId  Int
+  lesson    Lesson   @relation(fields: [lessonId], references: [id])
   score     Int
   userId    Int
   user      User     @relation(fields: [userId], references: [id])
 }
```


